{
  "schema_version": "rk-v1-first-slice-hostile-runtime-token-contract",
  "contract_id": "first_slice_hostile_runtime_token_contract_v1",
  "slice_id": "m0_first_vertical_slice",
  "source_docs": [
    "docs/design/first-slice-event-token-contract-matrix.md",
    "docs/design/first-vertical-slice.md",
    "docs/design/world-map-v1-phasing.md"
  ],
  "source_seed_tables": [
    "backend/src/app/config/seeds/v1/narrative/first-slice-content-key-manifest.json",
    "backend/src/app/config/seeds/v1/narrative/event-feed-messages.json"
  ],
  "retention_rationale": {
    "next_1_to_5_minute_goal": "Players issue one hostile order and immediately read deterministic event feedback with resolved placeholders.",
    "session_goal": "Keep hostile dispatch-to-resolution progress legible end-to-end without token/key mismatch failures.",
    "return_hook": "Stable hostile event wording and token contracts protect trust in battle logs and encourage return planning."
  },
  "scope_contract": {
    "included_hostile_phases": [
      "dispatch",
      "arrive",
      "resolve",
      "post_battle"
    ],
    "default_selection_policy": {
      "canonical_keys_only": true,
      "direct_default_selection_excludes_alias_only_keys": true
    },
    "alias_lookup_contract": {
      "deterministic_resolution_order": [
        "canonical_key",
        "legacy_keys_in_declared_order"
      ],
      "alias_keys_are_lookup_only": true
    }
  },
  "required_runtime_keys": [
    {
      "phase": "dispatch",
      "canonical_key": "event.world.hostile_foreign_settlement_spotted",
      "required_tokens": [
        "target_tile_label"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "dispatch",
      "canonical_key": "event.world.hostile_dispatch_target_required",
      "required_tokens": [],
      "compatibility_alias_keys": []
    },
    {
      "phase": "dispatch",
      "canonical_key": "event.world.hostile_dispatch_accepted",
      "required_tokens": [
        "army_name",
        "origin_settlement_name",
        "target_tile_label"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "dispatch",
      "canonical_key": "event.world.hostile_dispatch_en_route",
      "required_tokens": [
        "army_name",
        "target_tile_label",
        "eta_seconds"
      ],
      "compatibility_alias_keys": [
        "event.world.march_started"
      ]
    },
    {
      "phase": "dispatch",
      "canonical_key": "event.world.hostile_dispatch_failed",
      "required_tokens": [
        "error_code",
        "target_tile_label",
        "message"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "dispatch",
      "canonical_key": "event.world.hostile_dispatch_failed_source_target_not_foreign",
      "required_tokens": [
        "source_settlement_name"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "dispatch",
      "canonical_key": "event.world.hostile_dispatch_failed_max_active_marches_reached",
      "required_tokens": [
        "source_settlement_name"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "dispatch",
      "canonical_key": "event.world.hostile_dispatch_failed_path_blocked_impassable",
      "required_tokens": [
        "target_tile_label"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "dispatch",
      "canonical_key": "event.world.hostile_dispatch_failed_march_already_exists",
      "required_tokens": [
        "march_id"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "arrive",
      "canonical_key": "event.world.hostile_march_arrived_outer_works",
      "required_tokens": [
        "army_name",
        "target_tile_label"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "arrive",
      "canonical_key": "event.world.hostile_march_arrived_gate_contested",
      "required_tokens": [
        "army_name",
        "target_tile_label"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "resolve",
      "canonical_key": "event.combat.hostile_resolve_attacker_win",
      "required_tokens": [
        "army_name",
        "target_tile_label"
      ],
      "compatibility_alias_keys": [
        "event.combat.placeholder_skirmish_win"
      ]
    },
    {
      "phase": "resolve",
      "canonical_key": "event.combat.hostile_resolve_defender_win",
      "required_tokens": [
        "army_name",
        "target_tile_label"
      ],
      "compatibility_alias_keys": [
        "event.combat.placeholder_skirmish_loss"
      ]
    },
    {
      "phase": "resolve",
      "canonical_key": "event.combat.hostile_resolve_tie_defender_holds",
      "required_tokens": [
        "target_tile_label"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "resolve",
      "canonical_key": "event.combat.hostile_loss_report",
      "required_tokens": [
        "attacker_units_lost",
        "attacker_units_dispatched",
        "defender_garrison_lost",
        "defender_strength"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "resolve",
      "canonical_key": "event.combat.hostile_garrison_broken",
      "required_tokens": [
        "target_tile_label"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "resolve",
      "canonical_key": "event.combat.hostile_counterfire_heavy",
      "required_tokens": [],
      "compatibility_alias_keys": []
    },
    {
      "phase": "post_battle",
      "canonical_key": "event.world.hostile_retreat_ordered",
      "required_tokens": [
        "army_name",
        "target_tile_label",
        "settlement_name"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "post_battle",
      "canonical_key": "event.world.hostile_retreat_in_motion",
      "required_tokens": [
        "army_name"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "post_battle",
      "canonical_key": "event.world.hostile_retreat_completed",
      "required_tokens": [
        "army_name",
        "settlement_name",
        "attacker_units_remaining"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "post_battle",
      "canonical_key": "event.world.hostile_defeat_force_shattered",
      "required_tokens": [
        "target_tile_label",
        "army_name"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "post_battle",
      "canonical_key": "event.world.hostile_defeat_command_silent",
      "required_tokens": [
        "army_name"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "post_battle",
      "canonical_key": "event.world.hostile_post_battle_return_started",
      "required_tokens": [
        "army_name",
        "settlement_name"
      ],
      "compatibility_alias_keys": []
    },
    {
      "phase": "post_battle",
      "canonical_key": "event.world.hostile_post_battle_returned",
      "required_tokens": [
        "army_name",
        "settlement_name"
      ],
      "compatibility_alias_keys": [
        "event.world.march_returned"
      ]
    }
  ],
  "compatibility_alias_only_keys": [
    "event.world.march_started",
    "event.world.march_returned",
    "event.combat.placeholder_skirmish_win",
    "event.combat.placeholder_skirmish_loss"
  ],
  "deferred_post_slice_keys_excluded_from_contract": [
    {
      "key": "event.world.gather_started",
      "source_slice_status": "data_stub_post_slice",
      "reason": "Gather node loop is post-slice and outside hostile first-slice dispatch/arrive/resolve/post-battle runtime coverage."
    },
    {
      "key": "event.world.gather_completed",
      "source_slice_status": "data_stub_post_slice",
      "reason": "Gather completion outcomes are deferred and excluded from first-slice hostile runtime token contracts."
    },
    {
      "key": "event.world.ambush_triggered",
      "source_slice_status": "data_stub_post_slice",
      "reason": "Ambush triggers are deferred with post-slice map depth work and are excluded from this first-slice hostile contract."
    },
    {
      "key": "event.world.ambush_resolved",
      "source_slice_status": "data_stub_post_slice",
      "reason": "Ambush resolution outcomes are post-slice and excluded from this first-slice hostile contract."
    },
    {
      "key": "event.hero.assigned",
      "source_slice_status": "data_stub_post_slice",
      "reason": "Hero runtime payloads are explicitly post-slice and excluded from first-slice hostile runtime event token requirements."
    },
    {
      "key": "event.hero.unassigned",
      "source_slice_status": "data_stub_post_slice",
      "reason": "Hero detachment lifecycle messaging is deferred until post-slice hero rollout."
    },
    {
      "key": "event.hero.ability_activated",
      "source_slice_status": "data_stub_post_slice",
      "reason": "Hero ability events are outside first-slice scope and excluded from this contract."
    },
    {
      "key": "event.hero.cooldown_complete",
      "source_slice_status": "data_stub_post_slice",
      "reason": "Hero cooldown lifecycle events remain post-slice and excluded from first-slice hostile runtime coverage."
    }
  ]
}
